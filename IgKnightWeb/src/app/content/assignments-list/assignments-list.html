<div *ngIf = "viewAssignments || manageAssignments; else noAccess">
<div class="bg-white shadow-md rounded-2xl overflow-hidden max-w-5xl ml-14">
  <!-- Header -->
  <div class="bg-gradient-to-r from-orange-50 to-yellow-50 px-5 py-4 border-b border-gray-200">
    <h2 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
      <span class="text-orange-500 text-2xl"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-folder-open-icon lucide-folder-open"><path d="m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg></span>
      Existing Assignments
    </h2>
    <p class="text-sm text-gray-500">View and manage all created assignments</p>
  </div>

  <!-- Assignment Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm text-left text-gray-700">
      <thead class="bg-gray-50 text-gray-600 font-semibold">
        <tr class="ml-2">
          <th class="px-3 py-3">Assignment</th>
          <th class="px-3 py-3">Track/Level</th>
          <th class="px-3 py-3">Questions</th>
          <th class="px-3 py-3">Status</th>
          <th class="px-3 py-3" >Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let assignment of assignments" class="border-t hover:bg-gray-50">
          <!-- Title + Description + ID -->
          <td class="px-4 py-4">
            <div class="font-medium text-gray-800">{{ assignment.title }}</div>
            <div class="text-sm text-gray-500 truncate">{{ assignment.description }}</div>
          </td>

          <!-- Track / Level badges -->
          <td class="px-4 py-4">
            <div class="flex flex-col gap-1">
              <span class="text-xs font-medium border border-orange-400 text-orange-500 rounded-full px-2 py-0.5 w-fit">
                {{ getTechnologyName(assignment.technology) }}
              </span>
              <span
                class="text-xs font-medium rounded-full px-2 py-0.5 w-fit"
                [ngClass]="difficultyMap[assignment.difficultyLevel].class"
              >
                {{ difficultyMap[assignment.difficultyLevel].label }}
              </span>
            </div>
          </td>

          <!-- Questions badge -->
          <td class="px-4 py-4">
            <div class="flex items-center gap-1">
              <span
                class="bg-blue-100 text-blue-700 text-xs font-semibold px-2 py-1 rounded-full"
              >
                {{ assignment.totalQuestions }}
              </span>
            </div>
          </td>

          <!-- Status badge -->
          <td class="px-4 py-4">
            <span
              class="text-xs font-semibold px-3 py-1 rounded-full"
              [ngClass]="{
                'bg-green-100 text-green-700': assignment.status === AssignmentStatus.Published,
                'bg-yellow-100 text-yellow-700': assignment.status === AssignmentStatus.Draft
              }"
            >
              {{ getStatusLabel(assignment.status) }}
            </span>
          </td>

          <!-- Action buttons -->
          <td class="px-4 py-4">
            <div class="flex gap-2" *ngIf="viewAssignments; else noAccessForActions">
              <button (click)="handleEdit(assignment)" class="p-1.5 rounded-md border hover:bg-gray-100" title="Edit">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen"><path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z"/></svg>              </button>
              <button (click) = "openDeleteModal(assignment)" class="p-1.5 rounded-md border hover:bg-red-100 text-red-500" title="Delete">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash2-icon lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
              </button>
              <!-- Inside your assignment loop -->
              <button (click)="openModal(assignment)"  class="p-1.5 rounded-md border hover:bg-green-100 text-green">
                <ng-container *ngIf="assignment.status === AssignmentStatus.Published; else showSend">
                  <!-- Archive icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-archive-icon lucide-archive"><rect width="20" height="5" x="2" y="3" rx="1"/><path d="M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8"/><path d="M10 12h4"/></svg>
                </ng-container>
                <ng-template #showSend>
                  <!-- Send icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send-icon lucide-send"><path d="M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z"/><path d="m21.854 2.147-10.94 10.939"/></svg>
                </ng-template>
              </button>
            </div>
            <ng-template #noAccessForActions>
                <span class="text-red-500 font-bold text-xs flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lock-keyhole-icon lucide-lock-keyhole"><circle cx="12" cy="16" r="1"/><rect x="3" y="10" width="18" height="12" rx="2"/><path d="M7 10V7a5 5 0 0 1 10 0v3"/></svg>Actions are blocked</span>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
</div>

<ng-template #noAccess>
  <div class="flex items-center justify-center ml-14 max-w-5xl">
    <div class="flex flex-col items-center bg-white border-2 border-red-500 text-red-700 p-8 rounded-xl shadow-lg max-w-xl w-full animate-fade-in">
      <div class="flex items-center gap-2 mb-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.29 3.86L1.82 18a1 1 0 00.86 1.5h18.64a1 1 0 00.86-1.5L13.71 3.86a1 1 0 00-1.72 0zM12 9v4m0 4h.01" />
        </svg>
        <h2 class="text-xl font-semibold">Access Denied</h2>
      </div>
      <p class="text-sm text-center mb-3 px-4">
        You do not have permission to view or manage assignments.<br />
        If you believe this is an error, please contact your administrator.
      </p>
    </div>
  </div>
</ng-template>


<!-- Edit Assignment Dialog -->
<ng-container *ngIf="editingAssignment">
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl p-6">
      <!-- Header -->
      <div class="mb-6">
        <h2 class="text-xl font-semibold">Edit Assignment</h2>
        <p class="text-gray-500 text-sm">Make changes to your assignment details below.</p>
      </div>

      <!-- Form -->
      <form class="space-y-6">
        <!-- Title and Track -->
        <div class="grid grid-cols-2 gap-4">
          <!-- Title -->
          <div class="space-y-2">
            <label for="edit-title" class="text-sm font-medium text-gray-700">Assignment Title</label>
            <input
              id="edit-title"
              type="text"
              [(ngModel)]="editingAssignment.title"
              name="edit-title"
              class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"
              placeholder="Enter assignment title"
            />
          </div>

          <!-- Track -->
          <div class="space-y-2">
            <label for="edit-track" class="text-sm font-medium text-gray-700">Track</label>
            <select
              id="edit-track"
              [(ngModel)]="editingAssignment.technology"
              name="edit-track"
              class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"
            >
              <option disabled [ngValue]="null">Select track</option>
              <option *ngFor="let tech of technologies; let i = index" [ngValue]="i">
                {{ tech }}
              </option>
            </select>
          </div>
        </div>

        <!-- Description -->
        <div class="space-y-2">
          <label for="edit-description" class="text-sm font-medium text-gray-700">Description</label>
          <textarea
            id="edit-description"
            [(ngModel)]="editingAssignment.description"
            name="edit-description"
            class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"
            placeholder="Enter assignment description"
            rows="3"
          ></textarea>
        </div>

        <!-- Level -->
        <div class="grid grid-cols-3 gap-4">
          <div class="space-y-2">
            <label for="edit-level" class="text-sm font-medium text-gray-700">Difficulty Level</label>
            <select
              id="edit-level"
              [(ngModel)]="editingAssignment.difficultyLevel"
              name="edit-level"
              class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-orange-500 focus:border-orange-500"
            >
              <option disabled [ngValue]="null">Select level</option>
              <option *ngFor="let level of difficultyLevels; let i = index" [ngValue]="i">
                {{ level }}
              </option>
            </select>
          </div>
        </div>

        <!-- Buttons -->
        <div class="flex justify-end gap-3 pt-6 border-t">
          <button
            type="button"
            class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100"
            (click)="handleCancelEdit()"
          >
            Cancel
          </button>
          <button
            type="button"
            class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
            (click)="saveEditedAssignment()"
          >
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</ng-container>

<!-- Publish Confirmation Modal -->
<ng-container *ngIf="showPublishModal">
  <div class="fixed inset-0 z-50 bg-black/50 flex items-center justify-center">
    <div class="bg-white dark:bg-zinc-900 rounded-xl p-6 w-full max-w-md shadow-lg">
      <h2 class="text-xl font-semibold text-green-500">Confirm Publish</h2>
      <p class="mt-2 text-sm text-gray-700 dark:text-gray-300">
        Are you sure you want to publish the assignment <span class ="font-bold text-grey-600">{{ this.selectedAssignment.title }}</span>? Once published, this assignment will be visible to learners.
      </p>
      <div class="mt-6 flex justify-end gap-3">
        <button
          (click)="showPublishModal = false"
          class="px-4 py-2 rounded bg-gray-200 dark:bg-zinc-700 text-gray-800 dark:text-white"
        >
          Cancel
        </button>
        <button
          (click)="confirmPublish()"
          class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700"
        >
          Publish Now
        </button>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="showUnPublishModal">
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
      <h2 class="text-lg font-semibold text-yellow-500 mb-2">Unpublish Assignment</h2>
      <p class="text-sm text-gray-600 mb-4">
        Are you sure you want to unpublish <strong>{{ this.selectedAssignment.title }}</strong>? It will no longer be visible to learners.
      </p>
      
      <!-- Buttons -->
      <div class="flex justify-end gap-3 mt-6">
        <button
          class="px-4 py-2 text-sm font-medium border rounded-md hover:bg-gray-100"
          (click)="showUnPublishModal = false"
        >
          Cancel
        </button>
        <button
          class="px-4 py-2 text-sm font-medium bg-yellow-500 text-white rounded-md hover:bg-yellow-600"
          (click)="confirmUnpublish()"
        >
          Unpublish
        </button>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="deletingAssignment">
  <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
    <div class="bg-white rounded-xl shadow-lg w-full max-w-md p-6 space-y-4">
      <!-- Header -->
      <div class="flex items-start gap-4">
        <div class="mt-1 text-red-600">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none"
               viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
            <path d="M10 11v6M14 11v6" />
          </svg>
        </div>
        <div class="flex-1">
          <h2 class="text-lg font-semibold text-gray-800">Are you absolutely sure?</h2>
          <p class="text-sm text-gray-600 mt-1">
            Deleting <span class="font-semibold text-gray-800">{{ this.selectedAssignment.title }}</span> will
            permanently remove this assignment and all its associated questions and student submissions.
          </p>
          <p class="text-sm text-red-500 mt-2">
            This action is irreversible. Please proceed only if you’re certain.
          </p>
        </div>
      </div>

      <!-- Optional confirmation checkbox -->
      <div class="flex items-center gap-2">
        <input type="checkbox" id="confirmDelete" [(ngModel)]="deleteConfirmed"
               class="accent-red-600 rounded-md" />
        <label for="confirmDelete" class="text-sm text-gray-700">
          I understand that this cannot be undone.
        </label>
      </div>

      <!-- Footer buttons -->
      <div class="flex justify-end gap-3 pt-2">
        <button class="px-4 py-2 rounded-md border border-gray-300 text-gray-700 hover:bg-gray-100"
                (click)="deletingAssignment = true">
          Cancel
        </button>
        <button
          [disabled]="!deleteConfirmed"
          class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 disabled:opacity-50"
          (click)="confirmDelete()">
          Yes, Delete it
        </button>
      </div>
    </div>
  </div>
</ng-container>

